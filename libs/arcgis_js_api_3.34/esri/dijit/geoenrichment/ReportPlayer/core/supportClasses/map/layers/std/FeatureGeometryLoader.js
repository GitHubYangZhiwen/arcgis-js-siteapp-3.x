// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.34/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/std/FeatureGeometryLoader","esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/tasks/EnrichAreasTask esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/GEUtil esri/dijit/geoenrichment/utils/ArrayUtil esri/dijit/geoenrichment/utils/CacheUtil esri/dijit/geoenrichment/utils/InvokeUtil".split(" "),function(h,k,l,m,f,n){return{_countryKey:null,_countryId:null,_hierarchy:null,
_pendingInfos:{},canLoad:function(){return l.canMakeRequests()},getFeatureGeometry:function(a){var c=a.countryID+";"+a.hierarchy;this._countryKey!==c&&(f.set("FeatureGeometryLoader",{}),this._countryKey=c,this._pendingInfos={},this._countryId=a.countryID,this._hierarchy=a.hierarchy);var c=f.get("FeatureGeometryLoader"),b=this._getKey(a.levelId,a.featureId,a.outSR);c[b]||(c[b]=this._addToPendingGeographies(a.levelId,a.featureId,a.outSR));return c[b]},_addToPendingGeographies:function(a,c,b){var e=
this._getKey(a,c,b),d=new h;a={levelId:a,featureId:c,outSR:b,dfd:d};this._pendingInfos[e]&&d.promise.then(this._pendingInfos[e].dfd.resolve,this._pendingInfos[e].dfd.reject);this._pendingInfos[e]=a;n.invoke(this,"_doEnrichPendingGeographies",100);return d.promise},_doEnrichPendingGeographies:function(){function a(a){var d="default"===a?null:{wkid:Number(a)};m.splitArrayToBunches(b[a],50).forEach(function(a){(new k).createFeaturesForGeographies(a,{countryID:c._countryId,hierarchy:c._hierarchy,generalizationLevel:5,
outSR:d}).then(function(a){a.forEach(function(a){var b=c._getKey(a.attributes.StdGeographyLevel,a.attributes.StdGeographyID,d);f[b].dfd.resolve(a.geometry)})})})}var c=this,b={},e;for(e in this._pendingInfos){var d=this._pendingInfos[e],g=d.outSR&&d.outSR.wkid||"default";(b[g]=b[g]||[]).push({levelId:d.levelId,id:d.featureId})}var f=this._pendingInfos;this._pendingInfos={};for(g in b)a(g)},_getKey:function(a,c,b){return a+";"+c+";"+(b&&b.wkid)}}});