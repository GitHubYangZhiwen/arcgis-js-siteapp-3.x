// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.34/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/thisAreas/AreaFeatureLayersBuilder","dojo/_base/lang esri/Color esri/graphic esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/symbols/jsonUtils ./DefaultSymbolRenderer ../../Projector esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/areas/AreasInfoTemplateBuilder esri/dijit/geoenrichment/utils/ColorUtil".split(" "),function(n,p,w,x,y,q,r,t,z,u){var m={addAreaFeatures:function(a,f){var b=a.features.filter(function(a){return"polygon"===
a.geometry.type}),l=a.features.filter(function(a){return"point"===a.geometry.type}),d=[],c=[],e={},h=new t;b.forEach(function(k,b){b=m._addFeaturesToNewLayer(k,!1,a,h,f,b);e[c.length]=a.featureIndexToAreaIndexMap[a.features.indexOf(k)];c.push(b)});l.forEach(function(b,c){b=m._addFeaturesToNewLayer(b,!0,a,h,f,c);d.push(b)});h.project();return{pointLayers:d,polygonLayers:c,polygonLayerIndexToAreaIndex:e}},_addFeaturesToNewLayer:function(a,f,b,l,d,c){var e=new x,h=b.featureIndexToAreaIndexMap[b.features.indexOf(a)],
k=b.analysisAreas[h],k=f&&(a.locationName||k.locationName)||k.name,g=new w(null,m._getSymbolForGraphic(a,h,b),a.attributes),v=a.getLayer();g.setInfoTemplate(v&&v.infoTemplate||a.infoTemplate);!g.infoTemplate&&b.attachmentsStore&&z.buildInfoTemplateForFeature(b.attachmentsStore,g,h,k);e.name=g.infoTemplate&&g.infoTemplate.info&&g.infoTemplate.info.title||k;e.setRenderer(new y(g.symbol));t.needProject(a.geometry,b.map)?l.addForProjection(a.geometry,b.map).then(function(a){g.setGeometry(a);e.add(g)}):
(g.setGeometry(a.geometry),e.add(g));d.registerLayerInfo({layer:e,type:f?d.AREA_FEATURE_POINTS:d.AREA_FEATURE_POLYGONS,preferredIndex:c});return e},_getSymbolForGraphic:function(a,f,b){var l="point"===a.geometry.type,d=a.getLayer();if(a=d&&d.renderer&&d.renderer.getSymbol(a)||a.symbol)return q.fromJson(n.clone(a.toJson()));var c;if(l)c=b.pinSymbolJson;else if(a=b.areaSymbolJsons||[],d=a[f])c=d;else if(b.areaSymbolRamp&&2===b.areaSymbolRamp.length){var e=b.analysisAreas.length-a.length,h=f-a.length;
3>e?c=b.areaSymbolRamp[h]:(f=function(a,b){var c=a[3];a=p.toJsonColor(u.toColor(u.generateGradient(b.map(function(a){return p.toDojoColor(a)}),e)[h]));a[3]=c;return a},c=n.clone(b.areaSymbolRamp[0]),a=b.areaSymbolRamp.map(function(a){return a.color}).filter(function(a){return!!a}),d=b.areaSymbolRamp.map(function(a){return a.outline&&a.outline.color}).filter(function(a){return!!a}),a.length===b.areaSymbolRamp.length&&(c.color=f(c.color,a)),d.length===b.areaSymbolRamp.length&&(c.outline.color=f(c.outline.color,
d)))}return c?q.fromJson(n.clone(c)):l?r.generateSMS():r.generateSFS()}};return m});