// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.34/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/conversion/portalToEditorUtils/metadata/MetadataFromDataBuilder",["esri/dijit/geoenrichment/utils/JsonXmlConverter","./map/RendererToMetadataConverter"],function(w,k){var f={},x={STORE_ID:1,AREA_ID:1,StdGeographyName:1,StdGeographyID:1,StdGeographyLevel:1};f.recoverMetadataFromAreaData=function(g,f){g=g[0];var l={name:"DataCollection",tags:[{name:"Calculators",tags:[]}]},u={},d;for(d in g){var m=g[d].data,n=g[d].comparisonLevels,e=f.map[d],p=!!e,
e=p&&"object"===typeof e&&e.webMapJson||null,h=f.locator[d],h={name:p?"Maps":h?"Locator":"DataCollections",attributes:{Name:d},tags:[]};l.tags[0].tags.push(h);var q=[];if(p)for(var c in m){if(!x[c]){var r={name:"Map",attributes:{Name:c},tags:[{name:"Layers",tags:[]}]};e&&e.operationalLayers.forEach(function(a){if(a.isLocatorLayer){var b={name:"LocatorResultsLayer",attributes:{CalculatorName:a.calculatorName},tags:[k.convertRendererJson(a.featureCollection.layers[0].layerDefinition.drawingInfo.renderer)]};
u[a.calculatorName]=a.featureCollection.layers[0].title;r.tags[0].tags.push(b)}a.isComparisonLayer&&(b=a.featureCollection.layers[0].layerDefinition.drawingInfo,a={name:"ComparisonResultsLayer",attributes:{CalculatorName:a.calculatorName},tags:[k.convertRendererJson(b.renderer)]},b.labelingInfo&&a.tags.push(k.convertLabelingInfo(b.labelingInfo)),r.tags[0].tags.push(a))});q.push(r)}}else for(c in m)q.push({name:"Field",attributes:{Name:c,Alias:c,MapTo:"DC."+c,Type:"number"===typeof m[c]?"Double":"String"}});
h.tags.push({name:"Fields",tags:q});if(n&&n.length){var t=[],v={};n.forEach(function(a){a.StdGeographyLevel&&!v[a.StdGeographyLevel]&&(v[a.StdGeographyLevel]=1,t.push(a.StdGeographyLevel))});t.length&&h.tags.push({name:"ComparisonLevels",tags:t.map(function(a){return{name:"ComparisonLevel",attributes:{Name:a}}})})}}l.tags[0].tags.forEach(function(a){if("Locator"===a.name){var b=u[a.attributes.Name];b&&(a.attributes.LayerName=b)}});return w.parseJson(l)};return f});