// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.34/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreatePDFCommand","require dojo/_base/declare esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when ./CreateHTMLCommand ../../PlayerCommands ./supportClasses/ProgressSteps ./createHTML/CommandMode ../supportClasses/GEUtil esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi ../../_devConfig".split(" "),function(d,u,v,l,w,x,e,y,m,n,b,z){function A(){var k=new v;d(["esri/dijit/geoenrichment/utils/FileUtil",
"esri/dijit/geoenrichment/utils/MaskUtil","esri/dijit/geoenrichment/utils/requests/FileContent","./supportClasses/LayoutXMLBuilder"],function(c,e,a,b){p=c;q=e;r=a;t=b;k.resolve()});return k.promise}b=b.geoenrichment.dijit.ReportPlayer.ReportPlayer;var p,q,r,t;return u(w,{id:x.PDF,label:b.createPDFCommandLabel,errorMessage:b.createPDFError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:y.SVG,_requestSizeLimit:9E6,_replaceImagesWithItemResources:!0,_replaceMapsWithJson:!0,execute:function(k,c,b){var a=
this,d=this.inherited(arguments);return A().then(function(){var b=function(b){if(!c.skipErrorNotification)return a._handleError(b)};return l(d,function(h){if(h&&h.svgStrings){var g=t.buildLayoutXML(h);z.createPDFCommand.removeUnicodeChars&&(g=q.removeXMLMasks(g,"X"));if(c.returnLayoutXMLOnly)return g;var d={report:k.getReportTitle(),format:"pdf",f:"bin"},g=r.fromFileData("report.xml",g);delete g.filename;d["report.xml"]=g;return m.formatReport(d).then(function(f){if(f&&f.data)return!c.skipCreditConsumption&&
!n.createPDFCommand.skipCreditConsumption&&c.creditsTaskIDs&&c.creditsTaskIDs.forEach(function(a){m.consumeCredits(a)}),a._stepFinished(e.FORMAT_REPORT),f={name:c.fileName||k.getReportTitle()+".pdf",data:f.data},c.skipSavingFile||n.createPDFCommand.skipSavingFile||(a._saveMultipleFiles&&h.additionalFiles&&h.additionalFiles.length?a._saveMultipleFiles(f,h.additionalFiles):p.saveAs(f.data,f.name)),f;b()})}}).otherwise(b).always(function(b){return l(a._printableContainer&&a._printableContainer.stop(),
function(){return b})})}.bind(this))},_saveMultipleFiles:null,_stepFinished:function(b,c,d){if(this._currentProgressBack){var a=0;switch(b){case e.REPLACE_MAPS:a=10;break;case e.PREPARE_DOM:a=20;break;case e.RENDER_PAGE:a=20+60*c/d;break;case e.UNSET_LAYOUT:a=90;break;case e.FORMAT_REPORT:a=100}this._currentProgressBack(a/100)}}})});