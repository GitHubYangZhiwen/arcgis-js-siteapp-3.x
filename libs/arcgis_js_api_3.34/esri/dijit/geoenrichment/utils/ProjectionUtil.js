// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.34/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/ProjectionUtil","dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/SpatialReference esri/geometry/jsonUtils esri/dijit/geoenrichment/utils/CoordinateUtil esri/dijit/geoenrichment/utils/PolygonUtil esri/dijit/geoenrichment/utils/UrlUtil esri/dijit/geoenrichment/utils/requests/UniversalClient esri/dijit/geoenrichment/utils/requests/EveryRequest".split(" "),function(w,l,g,m,h,x,y,q,z){function n(a){return a&&a.spatialReference||a instanceof g&&a||a&&new g(a)||
new g(h.WEB_MERCATOR_WKID)}function A(a,b){var c=[];try{for(var d=0;d<a.length;d++)c.push(h.toSpatialReference(a[d],b))}catch(p){console.log(p)}return(new l).resolve(c)}function B(a,b){function c(a){r.push(function(){return C(e,a,p,b)})}var d=a[0],p=m.getJsonType(d),e={outSR:b.wkid||b.toJson(),inSR:d.spatialReference.wkid||d.spatialReference.toJson()},r=[],k=0,f=[];1==a.length?f.push(d):a.forEach(function(a){var b=x.getNumberOfPoints(a);k+=b;if(1E4<k){var d=[];f.length?(d.push(a),k=b):(f.push(a),
k=0);c(f);f=d}else f.push(a)});f.length&&c(f);return z(r,{stopOnError:!0}).then(function(a){for(var b=a[0],c=1;c<a.length;c++)b=b.concat(a[c]);return b},function(a){console.log(a);return[]})}function C(a,b,c,d){a.geometries=t(b);return q.requestPublicFirst({url:e.getGeometryServiceUrl(),urlSuffix:"project"},{content:a}).then(function(a){return u(a.geometries,c,d)})}function t(a){var b=a.map(function(a){a=a.toJson();delete a.spatialReference;return a});return{geometryType:m.getJsonType(a[0]),geometries:b}}
function u(a,b,c){var d=m.getGeometryType(b),e={spatialReference:c.toJson()};return a.map(function(a){return new d(w.mixin(a,e))})}var e={},v;e.setGeometryServiceUrl=function(a){v=a;y.registerCORS(a)};e.getGeometryServiceUrl=function(a){return v};e.getSpatialReference=n;e.projectGeometries=function(a,b){var c=n(b);b=Array.isArray(a)?a:[a];if(!b.length)return(new l).resolve(a);var d={},e=b.slice(),g=0;b=b.filter(function(a,b){if(a.spatialReference&&a.spatialReference.wkid!==c.wkid)return d[b]=g++,
!0});return b.length?(h.testSpatialReferenceWKID(c)&&h.testSpatialReferenceWKID(b[0].spatialReference)?A(b,c):B(b,c)).then(function(b){e.forEach(function(a,c){void 0!==d[c]&&(e[c]=b[d[c]])});return Array.isArray(a)?e:e[0]}):(new l).resolve(a)};e.unionGeometries=function(a){var b=n(a[0].spatialReference);a={sr:b.wkid||b.toJson(),geometries:t(a)};return q.requestPublicFirst({url:e.getGeometryServiceUrl(),urlSuffix:"union"},{content:a}).then(function(a){return u([a.geometry],a.geometryType,b)[0]})};
return e});