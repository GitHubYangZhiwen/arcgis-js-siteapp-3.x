// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.34/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/NodeProcessor",["esri/dijit/geoenrichment/promise/all","./drawing/SVGDrawer","./Clipper","./VisualsCollector"],function(r,h,q,t){return{processNode:function(a,b){var d={numIterations:0,lines:[],globalBoostIndex:0,promises:[]};this._processNode(a,null,null,null,0,b,d);return r(d.promises).then(function(){var a=[];d.lines.forEach(function(b){var e=b.subLines;delete b.subLines;a.push(b);e&&e.forEach(function(b){a.push(b)})});a.sort(function(a,
b){return a.stackIndex-b.stackIndex});return a})},_processNode:function(a,b,d,m,k,e,f){function g(a,b){if(a)if(Array.isArray(a))a.forEach(function(a){g(a)});else{b=b||1;if(a&&a.then){var c=f.lines.length;f.lines.push({text:"",stackIndex:++k,subLines:null});f.promises.push(a.then(function(a){var b=f.lines[c];if(Array.isArray(a)){b.text=a[0];a.shift();var d=b.stackIndex;b.subLines=a.map(function(a){return{text:a,stackIndex:++d}})}else b.text=a}))}else f.lines.push({text:a,stackIndex:++k});l+=b;k+=b-
1}}var l=0;if("#comment"===a.nodeName)return l;var c=t.getNodeVisuals(a,m);if(!c)return l;c.style.isRelAbs&&(f.globalBoostIndex+=1E6,k=f.globalBoostIndex);if("svg"===a.nodeName)return g(h.drawSVG(a,c,b)),l;if("IMG"===a.nodeName)return g(h.drawImage(a,c,b),100),l;m=function(){var a=c.style;return a.getBorder().radius||"auto"===a.getBackground().size||a.getBackground().repeatX||a.getBackground().repeatY?q.addClipping(c,e.definitions):b};c.style.getBackground().image&&"none"!==c.style.getBackground().image&&
g(h.drawBackgroundImage(c,m()),100);g(h.drawRect(c,b));g(h.drawBorder(c,b),4);if(a.childNodes.length){var p;"hidden"===c.style.overflow&&(p=e.clipFunc&&e.clipFunc(a),b=(d||e.useClipping||p)&&q.addClipping(c,e.definitions,b)||b);d=0;for(m=a.childNodes.length;d<m;d++){var n=a.childNodes[d];"#text"===n.nodeName?g(h.drawText(n,a,c,b)):(n=this._processNode(n,b,p,c,k,e,f),k+=n)}}return l}}});